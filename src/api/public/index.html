<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PJUD Scraper API - DocumentaciÃ³n</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .badges {
            margin-top: 20px;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            margin: 5px;
            font-size: 0.9em;
        }

        nav {
            background: #f8f9fa;
            padding: 15px 40px;
            border-bottom: 1px solid #ddd;
        }

        nav a {
            color: #667eea;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 600;
            transition: color 0.3s;
        }

        nav a:hover {
            color: #764ba2;
        }

        .content {
            padding: 40px;
        }

        section {
            margin-bottom: 40px;
        }

        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        h3 {
            color: #764ba2;
            margin: 20px 0 10px;
            font-size: 1.5em;
        }

        .endpoint {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .method {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 0.9em;
            margin-right: 10px;
        }

        .method.get { background: #28a745; color: white; }
        .method.post { background: #007bff; color: white; }
        .method.put { background: #ffc107; color: #333; }
        .method.delete { background: #dc3545; color: white; }

        .url {
            font-family: 'Courier New', monospace;
            background: #fff;
            padding: 10px;
            border-radius: 5px;
            display: inline-block;
            margin: 10px 0;
            color: #333;
        }

        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }

        code {
            font-family: 'Courier New', monospace;
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            color: #e74c3c;
        }

        .example {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .response {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .try-it {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
            margin: 10px 0;
        }

        .try-it:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        footer {
            background: #2d2d2d;
            color: white;
            text-align: center;
            padding: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        #status {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ” PJUD Scraper API</h1>
            <p>API REST para consulta de causas judiciales del Poder Judicial de Chile</p>
            <div class="badges">
                <span class="badge">v2.0.0</span>
                <span class="badge">REST API</span>
                <span class="badge">Base de Datos Separada: pjud_api</span>
                <span class="badge"><span id="status"></span> Online</span>
            </div>
        </header>

        <nav>
            <a href="#introduccion">IntroducciÃ³n</a>
            <a href="#arquitectura">Arquitectura</a>
            <a href="#endpoints">Endpoints</a>
            <a href="#ejemplos">Ejemplos</a>
            <a href="#demos">Demos</a>
        </nav>

        <div class="content">
            <section id="introduccion">
                <h2>ğŸ“– IntroducciÃ³n</h2>
                <p>Esta API proporciona acceso programÃ¡tico a los datos de causas judiciales, tribunales y movimientos procesales extraÃ­dos del sitio oficial del Poder Judicial de Chile.</p>

                <div class="info-box">
                    <strong>âš ï¸ Importante:</strong> Esta API utiliza una base de datos <strong>separada</strong> (<code>pjud_api</code>) de la aplicaciÃ³n Symfony principal (<code>codi_ejamtest</code>). Ambas tienen la misma estructura pero operan de forma independiente.
                </div>

                <h3>CaracterÃ­sticas</h3>
                <div class="grid">
                    <div class="card">
                        <h4>âœ… Base de Datos Separada</h4>
                        <p>La API lee y escribe en <code>pjud_api</code>, permitiendo escalabilidad y separaciÃ³n de concerns.</p>
                    </div>
                    <div class="card">
                        <h4>ğŸ”’ Acceso HTTPS</h4>
                        <p>ConexiÃ³n segura mediante Cloudflare Tunnel con certificado SSL automÃ¡tico.</p>
                    </div>
                    <div class="card">
                        <h4>ğŸ“Š Datos en Tiempo Real</h4>
                        <p>Los datos se actualizan mediante scraping programado del sitio PJUD.</p>
                    </div>
                    <div class="card">
                        <h4>ğŸš€ RESTful</h4>
                        <p>API diseÃ±ada siguiendo principios REST con respuestas JSON.</p>
                    </div>
                </div>
            </section>

            <section id="arquitectura">
                <h2>ğŸ—ï¸ Arquitectura del Sistema</h2>

                <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Internet (HTTPS)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Symfony     â”‚  â”‚  API + Front â”‚
        â”‚  (puerto 8000)â”‚  â”‚ (puerto 3000)â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ BD: codi_ejam  â”‚ â”‚ BD: pjud_api â”‚
        â”‚    (Symfony)   â”‚ â”‚    (API)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

                <h3>Componentes</h3>
                <ul>
                    <li><strong>Symfony App:</strong> Interfaz web tradicional con Twig</li>
                    <li><strong>API REST:</strong> Endpoints JSON para integraciÃ³n externa</li>
                    <li><strong>Frontend Docs:</strong> Esta pÃ¡gina de documentaciÃ³n</li>
                    <li><strong>Cloudflare Tunnel:</strong> ExposiciÃ³n segura sin abrir puertos</li>
                    <li><strong>2 Bases de Datos:</strong> SeparaciÃ³n de datos Symfony vs API</li>
                </ul>
            </section>

            <section id="endpoints">
                <h2>ğŸŒ Endpoints Disponibles</h2>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/health</span>
                    <p>Verifica el estado del servidor</p>
                    <button class="try-it" onclick="tryEndpoint('/api/health')">Probar â†’</button>
                    <div class="response" style="display:none;" id="response-health"></div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/causas</span>
                    <p>Lista todas las causas almacenadas en la BD pjud_api</p>
                    <button class="try-it" onclick="tryEndpoint('/api/causas')">Probar â†’</button>
                    <div class="response" style="display:none;" id="response-causas"></div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/causas/:id</span>
                    <p>Obtiene una causa especÃ­fica por ID</p>
                    <div class="example">
                        <strong>Ejemplo:</strong> <code>GET /api/causas/1</code>
                    </div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/causas/rit/:rit</span>
                    <p>Busca una causa por su RIT</p>
                    <div class="example">
                        <strong>Ejemplo:</strong> <code>GET /api/causas/rit/C-13786-2018</code>
                    </div>
                    <button class="try-it" onclick="tryEndpoint('/api/causas/rit/C-13786-2018')">Probar â†’</button>
                    <div class="response" style="display:none;" id="response-causas-rit"></div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/movimientos</span>
                    <p>Lista todos los movimientos procesales</p>
                    <button class="try-it" onclick="tryEndpoint('/api/movimientos')">Probar â†’</button>
                    <div class="response" style="display:none;" id="response-movimientos"></div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/movimientos/causa/:causa_id</span>
                    <p>Obtiene todos los movimientos de una causa especÃ­fica</p>
                    <div class="example">
                        <strong>Ejemplo:</strong> <code>GET /api/movimientos/causa/1</code>
                    </div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/tribunales</span>
                    <p>Lista todos los tribunales disponibles</p>
                    <button class="try-it" onclick="tryEndpoint('/api/tribunales')">Probar â†’</button>
                    <div class="response" style="display:none;" id="response-tribunales"></div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/competencias</span>
                    <p>Lista todas las competencias judiciales</p>
                    <button class="try-it" onclick="tryEndpoint('/api/competencias')">Probar â†’</button>
                    <div class="response" style="display:none;" id="response-competencias"></div>
                </div>

                <div class="endpoint">
                    <span class="method get">GET</span>
                    <span class="url">/api/cortes</span>
                    <p>Lista todas las cortes de apelaciones</p>
                    <button class="try-it" onclick="tryEndpoint('/api/cortes')">Probar â†’</button>
                    <div class="response" style="display:none;" id="response-cortes"></div>
                </div>

                <div class="endpoint">
                    <span class="method post">POST</span>
                    <span class="url">/api/scraping/causa</span>
                    <p>Solicita el scraping de una causa especÃ­fica y la guarda en pjud_api</p>
                    <div class="example">
                        <strong>Body:</strong>
                        <pre>{ "rit": "C-13786-2018" }</pre>
                    </div>
                </div>
            </section>

            <section id="ejemplos">
                <h2>ğŸ’» Ejemplos de Uso</h2>

                <h3>cURL</h3>
                <pre># Health check
curl https://api.tudominio.com/api/health

# Listar causas
curl https://api.tudominio.com/api/causas

# Buscar causa por RIT
curl https://api.tudominio.com/api/causas/rit/C-13786-2018

# Scrapear nueva causa
curl -X POST https://api.tudominio.com/api/scraping/causa \
  -H "Content-Type: application/json" \
  -d '{"rit": "C-13786-2018"}'</pre>

                <h3>JavaScript / Fetch</h3>
                <pre>// Obtener causas
fetch('https://api.tudominio.com/api/causas')
  .then(res => res.json())
  .then(data => console.log(data));

// Scrapear causa
fetch('https://api.tudominio.com/api/scraping/causa', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ rit: 'C-13786-2018' })
})
  .then(res => res.json())
  .then(data => console.log(data));</pre>

                <h3>Python</h3>
                <pre>import requests

# Obtener causas
response = requests.get('https://api.tudominio.com/api/causas')
causas = response.json()
print(causas)

# Scrapear causa
payload = {'rit': 'C-13786-2018'}
response = requests.post(
    'https://api.tudominio.com/api/scraping/causa',
    json=payload
)
print(response.json())</pre>
            </section>

            <section id="demos">
                <h2>ğŸ¨ Demos Interactivas</h2>
                <div class="grid">
                    <div class="card">
                        <h4>Demo BÃ¡sica</h4>
                        <p>Interfaz simple para explorar la API</p>
                        <a href="/demo.html" class="try-it" style="text-decoration:none; display:inline-block;">Ver Demo â†’</a>
                    </div>
                    <div class="card">
                        <h4>Movimientos</h4>
                        <p>VisualizaciÃ³n de movimientos procesales</p>
                        <a href="/demo-movimientos.html" class="try-it" style="text-decoration:none; display:inline-block;">Ver Demo â†’</a>
                    </div>
                    <div class="card">
                        <h4>MVP Dashboard</h4>
                        <p>Dashboard completo con estadÃ­sticas</p>
                        <a href="/mvp-dashboard.html" class="try-it" style="text-decoration:none; display:inline-block;">Ver Dashboard â†’</a>
                    </div>
                </div>
            </section>
        </div>

        <footer>
            <p>&copy; 2026 PJUD Scraper API | DocumentaciÃ³n v2.0.0</p>
            <p>Datos extraÃ­dos de <a href="https://oficinajudicialvirtual.pjud.cl" style="color: #667eea;">oficinajudicialvirtual.pjud.cl</a></p>
        </footer>
    </div>

    <script>
        // Verificar estado del servidor
        async function checkHealth() {
            try {
                const res = await fetch('/api/health');
                const data = await res.json();
                console.log('Health check:', data);
            } catch (err) {
                console.error('Server offline:', err);
                document.getElementById('status').style.background = '#dc3545';
            }
        }

        // Probar endpoint
        async function tryEndpoint(endpoint) {
            const responseId = 'response-' + endpoint.split('/').pop().replace(':', '');
            const responseDiv = document.getElementById(responseId);

            responseDiv.style.display = 'block';
            responseDiv.innerHTML = '<p>â³ Cargando...</p>';

            try {
                const res = await fetch(endpoint);
                const data = await res.json();
                responseDiv.innerHTML = `
                    <strong>âœ… Respuesta (${res.status}):</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (err) {
                responseDiv.innerHTML = `
                    <strong>âŒ Error:</strong>
                    <pre>${err.message}</pre>
                `;
                responseDiv.style.background = '#f8d7da';
                responseDiv.style.borderColor = '#dc3545';
            }
        }

        // Ejecutar health check al cargar
        checkHealth();
    </script>
</body>
</html>
